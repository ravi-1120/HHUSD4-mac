/*
* ReopenParentCaseWhenFulfillReopenTestMVN
* Created By:    Roman Lerman
* Created Date:  6/21/2013
* Description:   This is the test class for ReopenParentCaseWhenFulfillReopenedMVN class
*/
@isTest
private with sharing class ReopenParentCaseWhenFulfillReopenTestMVN {
	static Case parent1;
	static Fulfillment_MVN__c fulfillment1;
	static Fulfillment_MVN__c fulfillment2;

	static Case parent2;
	static Fulfillment_MVN__c fulfillment3;
	static Fulfillment_MVN__c fulfillment4;

	static List<Fulfillment_MVN__c> fulfillmentList;

	static {
		TestDataFactoryMVN.createSettings(true);

		parent1 = TestDataFactoryMVN.createClosedTestCase();
		fulfillment1 = TestDataFactoryMVN.createClosedTestFulfillment(null, parent1.Id);
		fulfillment2 = TestDataFactoryMVN.createClosedTestFulfillment(null, parent1.Id);

		parent2 = TestDataFactoryMVN.createClosedTestCase();
		fulfillment3 = TestDataFactoryMVN.createClosedTestFulfillment(null, parent2.Id);
		fulfillment4 = TestDataFactoryMVN.createClosedTestFulfillment(null, parent2.Id);
	}

	@isTest static void verifyParentOneReopened() {
		Test.startTest();
			fulfillment1.Status_MVN__c = 'Open';
			update fulfillment1;
		Test.stopTest();

		System.AssertEquals('Open', [select Status from Case where Id =: parent1.Id].Status);
		System.AssertEquals(TestDataFactoryMVN.interactionRecordTypeId, [select RecordType.Id from Case where Id =: parent1.Id].RecordTypeId);
		System.AssertEquals('Open', [select Status_MVN__c from Fulfillment_MVN__c where Id =: fulfillment1.Id].Status_MVN__c);
		System.AssertEquals('Closed', [select Status_MVN__c from Fulfillment_MVN__c where Id =: fulfillment2.Id].Status_MVN__c);

		System.AssertEquals('Closed', [select Status from Case where Id =: parent2.Id].Status);
		System.AssertEquals('Closed', [select Status_MVN__c from Fulfillment_MVN__c where Id =: fulfillment3.Id].Status_MVN__c);
		System.AssertEquals('Closed', [select Status_MVN__c from Fulfillment_MVN__c where Id =: fulfillment4.Id].Status_MVN__c);
	}
}