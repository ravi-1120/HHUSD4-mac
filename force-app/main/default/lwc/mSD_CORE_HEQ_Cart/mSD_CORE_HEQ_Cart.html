<template>
    <!-- Resource Selection Popup -->
    <template if:true={showResourceSelector}>
        <c-m-s-d_-c-o-r-e_-h-e-q_-resource-popup type="Browse All" submit-button="Add Items" page="Print"
            onselectedresources={handleSelectedResources} onclosemodelpopup={handleCloseSelector}></c-m-s-d_-c-o-r-e_-h-e-q_-resource-popup>
    </template>
    <!-- Resource Selection Popup End-->

    <!-- Cart Content -->
    <main class="cart-main">
        <div class="breadcrumbs">
            <span tabindex="0" class="breadcrumb1" onclick={redirectToHome}> Home ></span>
            <span class="breadcrumb2">Cart</span>
        </div>
        <div class="cart-container">
            <div class="cart-header">
                Cart
                <div class="dr-form_btnGroup slds-float_right">
                    <lightning-button role="button" class="lt-button cancel" variant="base" label="Continue browsing"
                        title="Continue browsing" onclick={handleContinuebrowsing}>
                    </lightning-button>
                    <lightning-button role="button" class="lt-button" variant="base" label="Place print order"
                        title="Place print order" onclick={handlePrintOrder}>
                    </lightning-button>
                </div>
            </div>
            <template for:each={displayedData} for:item="row">
                <div key={row.cartId} class="cart-content">
                    <div class="info">
                        <div>
                            <div class="infoName">{row.customerName}</div>
                            <div>{row.customerEmail}</div>
                        </div>
                        <div class="infoAddress">
                            <div if:true={row.customerAddress}>Delivery address: <span class="address-custom">{row.customerAddress}</span>&nbsp;
                            </div>
                            <div><a class="change-address-btn" data-account={row.accountId} data-customer={row.cartId} data-selfprint={row.isSelfPrint} onclick={handleChangeAddress}>
                                    <template if:true={row.isSelfPrint}>Assign address</template>
                                    <template if:false={row.isSelfPrint}>Change address</template>
                                </a></div>
                        </div>
                    </div>
                    <div class="grid-container">
                        <div class="grid-header">
                            <div></div>
                            <div>
                                Resource name
                            </div>
                            <div>
                                Resource id
                            </div>
                            <div class="grid-quantity">
                                Quantity:
                            </div>
                            <div>
                                <div class="placeholder"></div>
                            </div>
                        </div>
                        <template for:each={row.resources} for:item="resource">
                            <div key={row.id} class="grid-row">
                                <!-- Thumbnail Image -->
                                <div class="image">
                                    <template if:true={resource.ThumbnailUrl}>
                                        <img src={resource.ThumbnailUrl} alt="image" class="image-preview" />
                                    </template>
                                </div>

                                <!-- Resource Name -->
                                <div>
                                    <template if:true={resource.resourceName}>
                                        <div class="grid-name">{resource.resourceName}</div>
                                    </template>
                                </div>

                                <!-- Resource Code -->
                                <div>
                                    <template if:true={resource.resourceCode}>
                                        {resource.resourceCode}
                                    </template>
                                </div>

                                <!-- Quantity -->
                                <div class="grid-quantity">
                                    <template if:true={resource.quantity}>
                                        <div class="icons" data-id={resource.cartId} onclick={handleDecrement}>
                                            <svg tabindex="0" width="40" height="40" viewBox="0 0 40 40" fill="none"
                                                xmlns="http://www.w3.org/2000/svg">
                                                <rect width="40" height="40" rx="4" fill="#F4F4F4" />
                                                <path d="M23.3489 19.176V20.828H17.4129V19.176H23.3489Z"
                                                    fill="#A4A4A4" />
                                            </svg>
                                        </div>
                                        <lightning-input class="quantity-input" type="number" min="1" max="100" data-id={resource.cartId}
                                            variant="label-hidden" value={resource.quantity} onblur={handleQuantity}></lightning-input>
                                        <!-- <div class="quantity-input">{resource.quantity}</div> -->
                                        <div class="icons" data-id={resource.cartId} onclick={handleIncrement}>
                                            <svg  tabindex="0" width="40" height="40" viewBox="0 0 40 40" fill="none"
                                                xmlns="http://www.w3.org/2000/svg">
                                                <rect width="40" height="40" rx="4" fill="#F4F4F4" />
                                                <path
                                                    d="M23.5712 20.87H20.9252V23.586H19.0772V20.87H16.4312V19.162H19.0772V16.446H20.9252V19.162H23.5712V20.87Z"
                                                    fill="#333333" />
                                            </svg>
                                        </div>
                                    </template>
                                </div>
                                <div class="remove" >
                                    <svg onclick={handleDeleteItem} tabindex="0" data-id={resource.cartId} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                        fill="none">
                                        <path
                                            d="M8.4375 4.3125H8.25C8.35313 4.3125 8.4375 4.22812 8.4375 4.125V4.3125H15.5625V4.125C15.5625 4.22812 15.6469 4.3125 15.75 4.3125H15.5625V6H17.25V4.125C17.25 3.29766 16.5773 2.625 15.75 2.625H8.25C7.42266 2.625 6.75 3.29766 6.75 4.125V6H8.4375V4.3125ZM20.25 6H3.75C3.33516 6 3 6.33516 3 6.75V7.5C3 7.60313 3.08437 7.6875 3.1875 7.6875H4.60312L5.18203 19.9453C5.21953 20.7445 5.88047 21.375 6.67969 21.375H17.3203C18.1219 21.375 18.7805 20.7469 18.818 19.9453L19.3969 7.6875H20.8125C20.9156 7.6875 21 7.60313 21 7.5V6.75C21 6.33516 20.6648 6 20.25 6ZM17.1398 19.6875H6.86016L6.29297 7.6875H17.707L17.1398 19.6875Z"
                                            fill="#8C8C8C" />
                                    </svg>
                                </div>
                            </div>
                        </template>
                    </div>
                    <div key={row.id} class="dr-form_btnGroup slds-float_right addmore">
                        <lightning-button role="button" data-id={row.cartId} data-isselfprint={row.isSelfPrint} class="lt-button cancel" variant="base" label="Add more items"
                            title="Add more items" onclick={handleAddmoreItems}>
                        </lightning-button>
                    </div>
                </div>
            </template>
            <template if:false={displayedData}>
                <div class="no-records">Your cart is empty.</div>
            </template>
            <div class="print-btns">
                <div class="dr-form_btnGroup slds-float_right">
                    <lightning-button role="button" class="lt-button cancel" variant="base" label="Continue browsing"
                        title="Continue browsing" onclick={handleContinuebrowsing}>
                    </lightning-button>
                    <lightning-button role="button" class="lt-button" variant="base" label="Place print order"
                        title="Place print order" onclick={handlePrintOrder}>
                    </lightning-button>
                </div>
            </div>
        </div>
    </main>
    <!-- Cart Content End-->

    <!-- Delete Confirmation Popup -->
    <template if:true={deleteConfirmation}>
        <section role="dialog" tabindex="-1" aria-modal="true" aria-labelledby="modal-heading-01"
            class="slds-modal slds-fade-in-open slds-modal_medium">
            <div class="slds-modal__container">
                <div class="slds-modal__content mainmodelcls">
                    <div>
                        <div class="collectionheadercls">
                            <div class="collectionheadertxt">Delete confirmation</div>
                            <div>
                                <lightning-icon icon-name="utility:close" size="small" alternative-text="close"
                                    class="closeiconclick" title="close" onclick={handleClosePopup}>
                                </lightning-icon>
                            </div>
                        </div>
                        <div class="collectionbodytxt">
                            Are you sure you want to delete this from the cart?
                        </div>
                    </div>
                    <div class="collectionfootercls">
                        <div class="dr-form_btnGroup slds-float_right">
                            <lightning-button role="button" class="lt-button cancel" variant="base" label="Cancel" title="Cancel"
                                onclick={handleClosePopup}>
                            </lightning-button>
                            <lightning-button role="button" class="lt-button" variant="base" label="Delete" title="Delete"
                                onclick={handleDeleteCartItem}>
                            </lightning-button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <div class="slds-backdrop slds-backdrop_open" role="presentation"></div>
    </template>
    <!-- Delete Confirmation Popup -->

    <!-- Other Address Popup -->
    <template if:true={showOtherAddress}>
        <c-m-s-d_-c-o-r-e_-h-e-q_-change-address accountid={accountId} self-print-address={selfPrintAddress} customer-id={selectedCustomer} onaddresssubmit={handleAddressRefresh} onclosemodel={handleCloseOtherAddress} onsubmitaddress={handleAddressRefresh}></c-m-s-d_-c-o-r-e_-h-e-q_-change-address>
    </template>
    <!-- Other Address Popup -->

    <div if:true={showSpinner}>
        <c-m-s-d_-c-o-r-e_-h-e-q_-spinner></c-m-s-d_-c-o-r-e_-h-e-q_-spinner>
    </div>
</template>