<template>
    <c-custom-toast auto-close-time="3000"></c-custom-toast>
    <main class="maincontainer">
        <div class="breadcrumbs">
            <div>
                <span class="breadcrumb1" onclick={redirectToHome}> {labels.home} ></span>
                <span class="breadcrumb1" onclick={navigateToCollections}> {labels.collections} ></span>
                <span if:false={isCustomer} class="breadcrumb1" onclick={navigateToNewCollections}> {labels.addnewcollection} ></span>
                <span if:true={collectionRecord} class="breadcrumb2">{collectionRecord.name}</span>
                <span if:false={isCustomer} class="breadcrumb2">{collectionData.name}</span>
            </div>
        </div>
        <template if:true={isCustomer}>
            <div>
                <img src={collectionRecord.imageUrl} alt="Header Image" class="header-image" />
            </div>
            <div class="collection-container">
                <div class="collection-data">
                    <div>Items: <span class="col-val">{collectionRecord.resourceCount}</span></div>
                    <div>Shared On: <span class="col-val">{collectionRecord.createdDate}</span></div>
                    <div>Shared By: <span class="col-val">{collectionRecord.sharedBy}</span></div>
                </div>
                <div class="resource-container"> <template for:each={collectionItems} for:item="item">
                        <c-m-s-d_-c-o-r-e_-h-e-q_-generic-tiles key={item.id} item={item} grid-type="grid1"
                            menu-options={menuOptions} category="Collection-resource" onshowmenu={handleShowMenu}
                            onmenuclick={handleMenuClick}>
                        </c-m-s-d_-c-o-r-e_-h-e-q_-generic-tiles>
                    </template>
                </div>
            </div>
        </template>
        <template if:true={isAccountExe}>
            <div if:true={collectionData}>
                <div class="header-container">
                    <h1 class="title">{collectionData.name}</h1>
                    <div class="icon-container">
                        <lightning-icon icon-name="utility:back" size="x-small" alternative-text="Back"
                            class="icon-border" onclick={handleBackClick}></lightning-icon>
                        <lightning-icon icon-name="utility:edit" size="x-small" alternative-text="Edit"
                            class="icon-border" data-id={collectionData.id} onclick={handleEditClick}></lightning-icon>
                        <lightning-icon icon-name="utility:delete" size="x-small" alternative-text="Delete"
                            class="icon-border" data-id={collectionData.id}
                            onclick={handleDeleteClick}></lightning-icon>
                    </div>
                </div>
                <div class="image-container">
                    <img src={collectionData.ThumbnailUrl} alt="Header Image" class="header-image" />
                </div>
            </div>
            <div class="tabs-container">
                <div class="tab-button">
                    <button class={resourcesTabClass} onclick={handleTabClick}
                        data-tab="resources">{labels.collectionItem}</button>
                    <button class={sharedWithTabClass} onclick={handleTabClick}
                        data-tab="sharedWith">{labels.sharedWith}</button>
                </div>
                <div if:true={isResourcesActive} class="add-item-container">
                    <button class="slds-button slds-button_brand" onclick={handleAddItemClick}>{labels.addItem}</button>
                </div>
                <div if:true={isSharedWithActive} class="add-item-container">
                    <button class="slds-button slds-button_brand" onclick={handleselectuserClick}>Select customer</button>
                </div>
            </div>
            <div class="tab-content">
                <template if:true={isResourcesActive}>
                    <template if:false={isResourcesEmpty}>
                        <div class="tile-container">
                            <template for:each={resources} for:item="doc">
                                <c-m-s-d_-c-o-r-e_-h-e-q_-generic-tiles item={doc} key={doc.id}
                                        grid-type="grid2" genericview="tile" menu-options="close"
                                        contentdocumentid={doc.contentdocumentid} 
                                        iscloseicon=true oncloseresourceclick={handleDeleteIcon}>
                                </c-m-s-d_-c-o-r-e_-h-e-q_-generic-tiles>
                            </template>
                        </div>
                    </template>
                    <template if:true={isResourcesEmpty}>
                        <div class="section">{labels.addMoreResource}</div>
                    </template>
                </template>
                <template if:true={isSharedWithActive}>
                    <div class="bodycls" if:false={nosharedCustomer}>
                        <table>
                            <tr>
                                <th>{labels.firstname}</th>
                                <th>{labels.lastname}</th>
                                <th>{labels.email}</th>
                                <th>{labels.last_accessed_date}</th>
                                <th>{labels.actions}</th>
                                <th></th>
                            </tr>
                            <template for:each={sharedCustomerData} for:item="customer">
                                <tr key={customer.Id}>
                                    <td>{customer.FirstName}</td>
                                    <td>{customer.LastName}</td>
                                    <td>{customer.Email}</td>
                                    <td></td>
                                    <td>
                                        <template if:false={customer.IsRegister}>
                                            <span data-id={customer.Id} onclick={sendInvite}>Re-invite</span>
                                        </template>
                                    </td>
                                    <td>
                                        <lightning-icon class="closeicon" icon-name="utility:close"
                                            alternative-text="close" size="medium" onclick={handleunsharecollection}
                                            data-id={customer.Id} data-fname={customer.FirstName}
                                            data-isregister={customer.IsRegister}
                                            data-lname={customer.LastName} data-email={customer.Email}>
                                        </lightning-icon>
                                    </td>
                                </tr>
                            </template>

                        </table>
                    </div>
                    <div if:true={nosharedCustomer} class="noCustomertxt">
                        {labels.noshared1}
                        </br>
                        {labels.noshared2} <span onclick={handleselectuserClick}>here</span>
                    </div>
                </template>
            </div>
        </template>
    </main>

    <template if:true={unsharecollectionpopup}>
        <section role="dialog" tabindex="-1" class="slds-modal slds-fade-in-open">
            <div class="slds-modal__container">
                <div class="slds-modal__content removeusermodelbody">
                    <div class="removeusermodelheader">
                        <span>{labels.removeuser}</span>
                        <lightning-icon icon-name="utility:close" size="small" alternative-text="close"
                            class="closeiconclick" title="close" onclick={closeUnshareModal}>
                        </lightning-icon>
                    </div>
                    <div class="removeuserbodytxt">{labels.confirmcollectiontext}</div>
                    <div class="removeusername">{selectedcustomername}</div>
                    <div class="removeuseremail">{selectedcustomeremail}</div>
                    <div class="removuserbtncls">
                        <button class="slds-button slds-button_brand" onclick={unshareCollection}>Yes</button>
                        <button class="slds-button slds-button_neutral" onclick={closeUnshareModal}>No</button>
                    </div>
                </div>
            </div>
        </section>
        <div class="slds-backdrop slds-backdrop_open"></div>
    </template>

    <template if:true={isModalOpen}>
        <section role="dialog" tabindex="-1" class="slds-modal slds-fade-in-open">
            <div class="slds-modal__container">
                <!-- Modal/Popup Header -->
                <header class="slds-modal__header">
                    <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse"
                        title="Close" onclick={closeModal}>
                        <lightning-icon icon-name="utility:close" alternative-text="close"
                            size="small"></lightning-icon>
                        <span class="slds-assistive-text">Close</span>
                    </button>
                    <h2 class="slds-text-heading_medium">Delete Confirmation</h2>
                </header>

                <!-- Modal/Popup Body -->
                <div class="slds-modal__content slds-p-around_medium">
                    <p>Are you sure you want to delete the document "{popupTitle}"?</p>
                </div>

                <!-- Modal/Popup Footer -->
                <footer class="slds-modal__footer">
                    <button class="slds-button slds-button_neutral" onclick={closeModal}>Cancel</button>
                    <button class="slds-button slds-button_brand" onclick={handleDelete}>Delete</button>
                </footer>
            </div>
        </section>
        <div class="slds-backdrop slds-backdrop_open"></div>
    </template>

    <!-- Delete button Popup -->
    <template if:true={showConfirmationModal}>
        <section role="dialog" tabindex="-1" class="slds-modal slds-fade-in-open">
            <div class="slds-modal__container">
                <header class="slds-modal__header">
                    <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse"
                        title="Close" onclick={closeConfirmationModal}>
                        <lightning-icon icon-name="utility:close" alternative-text="close"
                            size="small"></lightning-icon>
                        <span class="slds-assistive-text">Close</span>
                    </button>
                    <h2 class="slds-text-heading_medium">Confirm Deletion</h2>
                </header>

                <div class="slds-modal__content slds-p-around_medium">
                    <p>Are you sure you want to delete this collection?</p>
                </div>

                <footer class="slds-modal__footer">
                    <lightning-button label="Cancel" style="padding-right: 5px;" onclick={closeConfirmationModal}>
                    </lightning-button>
                    <lightning-button variant="destructive" label="Delete" onclick={handleDeleteConfirm}>
                    </lightning-button>
                </footer>
            </div>
        </section>
        <div class="slds-backdrop slds-backdrop_open"></div>
    </template>

    <!-- Collection with Customer -->
    <template if:true={showuser}>
        <section role="dialog" tabindex="-1" aria-modal="true" aria-labelledby="modal-heading-01"
            class="slds-modal slds-fade-in-open slds-modal_medium">
            <div class="slds-modal__container filter-modal">
                <div class="slds-modal__content mainmodel-print">
                    <div>
                        <div class="filter-header">
                            <div class="filter-header-txt">Select Customers</div>
                            <div class="close-icon">
                                <lightning-icon icon-name="utility:close" size="small" alternative-text="close"
                                    class="closeiconclick" title="close" onclick={closeCustomerModel}>
                                </lightning-icon>
                            </div>
                        </div>
                        <div class="print-bd">
                            <c-m-s-d_-c-o-r-e_-h-e-q_-customer main-header="" footerbtnname="Share"
                                customertype="allcustomers" feature="edeliver" is-footerbutton=true
                                onclosemodel={closeCustomerModel} hide-add-recipient=true onsharecustomerdata={getSelectedCustomer}>
                            </c-m-s-d_-c-o-r-e_-h-e-q_-customer>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <div class="slds-backdrop slds-backdrop_open" role="presentation"></div>
    </template>

    <!-- Resource with category -->
    <template if:true={showResourceModel}>
        <c-m-s-d_-c-o-r-e_-h-e-q_-resource-popup type="Browse All" submit-button="Add Items" 
            onclosemodelpopup={handlecloseAddItem}
            onselectedresources={handleSelectedResources}></c-m-s-d_-c-o-r-e_-h-e-q_-resource-popup>
    </template>

    <template if:true={showSpinner}>
        <c-m-s-d_-c-o-r-e_-h-e-q_-spinner></c-m-s-d_-c-o-r-e_-h-e-q_-spinner>
    </template>
</template>