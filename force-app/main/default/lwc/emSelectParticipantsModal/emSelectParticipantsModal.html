<template>
    <c-veeva-modal onclose={handleClose} size="large">
        <div slot="header">
            {labels.selectParticipants}
        </div>
        <div slot="content">
            <div>
                <div if:true={views.length} class="search slds-combobox-group">
                    <div class="slds-combobox_object-switcher slds-combobox-addon_start">
                        <div class="slds-combobox_container">
                            <c-em-combobox options={views} onselect={handleViewSelect} selected={currentView} width-override=true></c-em-combobox>
                        </div>
                    </div>
                    <div class="slds-combobox_container slds-combobox-addon_end">
                        <lightning-input class="view-search" variant="label-hidden" min-length="2" onchange={updateTerm}
                            placeholder={searchPlaceholder} type="search" value={searchTerm}></lightning-input>
                    </div>
                    <div class="remove-all">
                        <lightning-button if:true={labels.removeAll} label={labels.removeAll} onclick={handleRemoveAll}
                            variant="base"></lightning-button>
                    </div>
                </div>
                <div if:true={selectedRowsPills.length} class="selected-rows slds-m-top_x-small">
                    <template for:each={selectedRowsPills} for:item="row">
                        <span class="selection-page-pill" key={row.participantId}>
                            <c-veeva-pill icon={row.icon} icon-shape="circle" label={row.Incurred_Expense_vod__c} value={row.participantId}
                                onremove={handleRemoveSelectedPill} variant="round"></c-veeva-pill>
                        </span>
                    </template>
                </div>
            </div>
            <div class="slds-m-vertical_small">
                <div class="result-selection-sort-message">
                    <span>
                        {numResults} {numSelected} {sortedByLabel}
                    </span>
                    <lightning-icon if:true={sortDirection} icon-name={sortDirectionIcon} size="xx-small"></lightning-icon>
                </div>
                <div class="slds-p-top_xx-small">
                    <div class="slds-is-relative slds-border_top slds-border_left slds-border_right slds-border_bottom">
                        <c-veeva-spinner if:true={loading}></c-veeva-spinner>
                        <div class="results-data-table">
                            <lightning-datatable columns={columns} data={results} enable-infinite-loading={hasMoreData} key-field="id"
                                selected-rows={selectedRowsIds} sorted-by={sortedBy} sorted-direction={sortDirection}
                                onloadmore={loadMore} onrowselection={handleRowSelection} onsort={handleSort}>
                            </lightning-datatable>
                        </div>
                        <div class="slds-illustration slds-illustration_small no-results" if:true={noResults}>
                            <div class="slds-text-longform">
                                <h3 class="slds-text-heading_medium">{labels.noRecords}</h3>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div slot="footer">
            <div class="footer-buttons slds-button-group-row">
                <lightning-button class="slds-button-group-item" data-id="cancelButton" if:true={labels.cancel} label={labels.cancel}
                    title={labels.cancel} onclick={handleClose} variant="neutral"></lightning-button>
                <lightning-button class="slds-button-group-item" data-id="saveButton" if:true={labels.save} label={labels.save} title={labels.save}
                    onclick={save} variant="brand"></lightning-button>
            </div>
        </div>
    </c-veeva-modal>
</template>