<template>

    <main class="maincontainer">
        <div>
            <div class="breadcrumbs">
                <span class="breadcrumb1" onclick={redirectToHome}> {labels.home} ></span>
                <span class="breadcrumb2"> Order history </span>
            </div>

            <div class="header-container">
                <h1 class="title">Order history</h1>
            </div>
        </div>
    </main>

    <div class="tabs-container">
        <div class="tab-button">
            <button class={printTabClass} onclick={handleTabClick}
                        data-tab="print">Print</button>
            <button class={eDeliveryTabClass} onclick={handleTabClick}
                        data-tab="eDelivery">e-Delivery</button>
        </div>

        <div class="search-box">
            <div class="search-container">
                <input
                          type="search"
                          id="searchInput"
                          value={searchKey}
                          oninput={handleSearchKeyChange}
                          placeholder="Search customer"
                          class="custom-search-input"
                      />
                <div class="search-icon-container">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="25" viewBox="0 0 24 25" fill="none">
                        <path
                            d="M21.3187 20.5273L15.232 14.4406C16.1766 13.2195 16.6875 11.7266 16.6875 10.1562C16.6875 8.27656 15.9539 6.51406 14.6273 5.18516C13.3008 3.85625 11.5336 3.125 9.65625 3.125C7.77891 3.125 6.01172 3.85859 4.68516 5.18516C3.35625 6.51172 2.625 8.27656 2.625 10.1562C2.625 12.0336 3.35859 13.8008 4.68516 15.1273C6.01172 16.4562 7.77656 17.1875 9.65625 17.1875C11.2266 17.1875 12.7172 16.6766 13.9383 15.7344L20.025 21.8187C20.0428 21.8366 20.064 21.8508 20.0874 21.8604C20.1107 21.8701 20.1357 21.8751 20.1609 21.8751C20.1862 21.8751 20.2112 21.8701 20.2345 21.8604C20.2578 21.8508 20.279 21.8366 20.2969 21.8187L21.3187 20.7992C21.3366 20.7814 21.3508 20.7602 21.3604 20.7369C21.3701 20.7135 21.3751 20.6885 21.3751 20.6633C21.3751 20.638 21.3701 20.613 21.3604 20.5897C21.3508 20.5664 21.3366 20.5452 21.3187 20.5273ZM13.3688 13.8688C12.375 14.8602 11.0578 15.4062 9.65625 15.4062C8.25469 15.4062 6.9375 14.8602 5.94375 13.8688C4.95234 12.875 4.40625 11.5578 4.40625 10.1562C4.40625 8.75469 4.95234 7.43516 5.94375 6.44375C6.9375 5.45234 8.25469 4.90625 9.65625 4.90625C11.0578 4.90625 12.3773 5.45 13.3688 6.44375C14.3602 7.4375 14.9062 8.75469 14.9062 10.1562C14.9062 11.5578 14.3602 12.8773 13.3688 13.8688Z"
                            fill="#555555" />
                    </svg>
                </div>
            </div>
        </div>
        <div class="searchmbl">
            <div class="search-icon-container">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="25" viewBox="0 0 24 25" fill="none">
                    <path
                        d="M21.3187 20.5273L15.232 14.4406C16.1766 13.2195 16.6875 11.7266 16.6875 10.1562C16.6875 8.27656 15.9539 6.51406 14.6273 5.18516C13.3008 3.85625 11.5336 3.125 9.65625 3.125C7.77891 3.125 6.01172 3.85859 4.68516 5.18516C3.35625 6.51172 2.625 8.27656 2.625 10.1562C2.625 12.0336 3.35859 13.8008 4.68516 15.1273C6.01172 16.4562 7.77656 17.1875 9.65625 17.1875C11.2266 17.1875 12.7172 16.6766 13.9383 15.7344L20.025 21.8187C20.0428 21.8366 20.064 21.8508 20.0874 21.8604C20.1107 21.8701 20.1357 21.8751 20.1609 21.8751C20.1862 21.8751 20.2112 21.8701 20.2345 21.8604C20.2578 21.8508 20.279 21.8366 20.2969 21.8187L21.3187 20.7992C21.3366 20.7814 21.3508 20.7602 21.3604 20.7369C21.3701 20.7135 21.3751 20.6885 21.3751 20.6633C21.3751 20.638 21.3701 20.613 21.3604 20.5897C21.3508 20.5664 21.3366 20.5452 21.3187 20.5273ZM13.3688 13.8688C12.375 14.8602 11.0578 15.4062 9.65625 15.4062C8.25469 15.4062 6.9375 14.8602 5.94375 13.8688C4.95234 12.875 4.40625 11.5578 4.40625 10.1562C4.40625 8.75469 4.95234 7.43516 5.94375 6.44375C6.9375 5.45234 8.25469 4.90625 9.65625 4.90625C11.0578 4.90625 12.3773 5.45 13.3688 6.44375C14.3602 7.4375 14.9062 8.75469 14.9062 10.1562C14.9062 11.5578 14.3602 12.8773 13.3688 13.8688Z"
                        fill="#555555" />
                </svg>
            </div>
        </div>
    </div>

    <template if:true={isPrintTabActive}>
        <div class="printcard-container">
            <template for:each={customerOrders} for:item="order">
                <div class="printcard" key={order.orderId}>
                    <div class="left-column">
                        <div class="viewmblcls">
                            <div class="customer-name-mbl">{order.customerName}</div>
                            <div>
                                <a class="resend" onclick={handlePrintIconClick}
                                    data-customer-name={order.customerName}>
                                    view
                                </a>
                            </div>
                        </div>
                        <div class="customer-name">{order.customerName}</div>

                        <div class="printorderID">
                            <div class="printrightcolumn" key={order.orderId}>
                                <div class="keyclass">Order ID</div>
                                <div class="valueclass">{order.orderId}</div>
                            </div>

                            <div class="printrightcolumn" key={order.statusKey}>
                                <div class="keyclass">Order status</div>
                                <div class="valueclass">{order.orderStatus}</div>
                            </div>
                        </div>

                        <hr class="hrmbl">
                    </div>

                    <!-- Tab version for print collapsed state starts here -->
                    <div class="printrightcolumn" key={order.detailsKey}>
                        <div class="printdatecolumn">
                            <div class="printdate">
                                <div class="keyclass">Order placed</div>
                                <div class="valueclass">{order.CreatedDate}</div>
                            </div>
                            <div class="printaddress">
                                <div class="keyclass1">Delivery address:</div>
                                <div class="valueclass">{order.address}</div>
                            </div>
                        </div>

                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="10" viewBox="0 0 16 10" fill="none"
                            class="svgiconcls" onclick={handlePrintIconClick} data-customer-name={order.customerName}
                            data-order-id={order.orderId}>
                            <path
                                d="M15.8838 1.16002L8.42044 9.81421C8.20681 10.0619 7.79546 10.0619 7.57956 9.81421L0.11623 1.16002C-0.161031 0.837306 0.0889585 0.364598 0.536668 0.364598H15.4633C15.911 0.364598 16.161 0.837306 15.8838 1.16002Z"
                                fill="black" fill-opacity="0.45" />
                        </svg>
                    </div>
                </div>

                <div class="printtabcard" key={order.orderId}>
                    <div class="left-column">
                        <div class="viewmblcls">
                            <div class="customer-name-mbl">{order.customerName}</div>
                            <div>
                                <a class="resend" onclick={handlePrintIconClick}
                                    data-customer-name={order.customerName}>
                                    view
                                </a>
                            </div>
                        </div>
                        <div class="customer-name">{order.customerName}</div>


                        <div class="taborderID">
                            <div class="tabdeliverycls">
                                <div class="keyclass" key={order.orderId}> Order id</div>
                                <div class="valueclass">{order.orderId}</div>
                            </div>
                            <div class="tabdeliverycls">
                                <div class="keyclass" key={order.statusKey}> Order status</div>
                                <div class="valueclass">{order.orderStatus}</div>
                            </div>
                        </div>

                        <div class="tabdeliverycls">
                            <div class="keyclass">Delivery Address:</div>
                            <div class="valueclass">{order.address}</div>
                        </div>

                        <hr class="hrmbl">
                    </div>

                    <div class="printrightcolumn">
                        <div class="printdatecolumn">
                            <div class="printdate">
                                <div class="date">Order Placed:</div>
                                <div class="delivery-date">09/18/2024 05:45 PM</div>
                            </div>
                            <!-- <div class="printaddress">
                                <div class="keyclass1">Delivery Address:</div>
                                <div class="valueclass">{order.address}</div>
                            </div> -->
                        </div>

                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="10" viewBox="0 0 16 10" fill="none"
                            class="svgicon" onclick={handlePrintIconClick} data-customer-name={order.customerName}
                            data-order-id={order.orderId}>
                            <path
                                d="M15.8838 1.16002L8.42044 9.81421C8.20681 10.0619 7.79546 10.0619 7.57956 9.81421L0.11623 1.16002C-0.161031 0.837306 0.0889585 0.364598 0.536668 0.364598H15.4633C15.911 0.364598 16.161 0.837306 15.8838 1.16002Z"
                                fill="black" fill-opacity="0.45" />
                        </svg>
                    </div>
                </div>
                <!-- Tab version for print collapsed state ends here -->


                <div if:true={order.isExpanded} key={order.orderId}>
                    <div class="tracking-info">
                        <div>
                            Tracking number: <strong>4587863246</strong>
                        </div>
                        <div>
                            Track order: <a href="https://www.tracking/876767"
                                target="_blank">https://www.tracking/876767</a>
                        </div>
                        <div>
                            Tracking Status: <strong>Delivered</strong>
                        </div>
                    </div>
                    <table class="resourcedetails">
                        <thead class="tableheader">
                            <tr>
                                <th class="headertxt"> </th>
                                <th class="headertext">Resource name</th>
                                <th class="headertext">Resource ID</th>
                                <th class="headertext">Item Quantity</th>
                                <th class="headertext"></th>
                            </tr>
                        </thead>
                        <tbody class="tablebody">
                            <template for:each={order.orderItems} for:item="resource">
                                <tr key={resource.resourceId}>
                                    <td>
                                        <img src={MSD_CORE_HEQ_Thumbnail} alt="Thumbnail" style="width: 30px; height: 36.122px;" />
                                    </td>
                                    <td class="resourceName">resource.contentTitle</td>
                                    <td>US-NON-1234</td>
                                    <td>{resource.itemQuantity}</td>
                                    <td class="resend">
                                        <a class="resend" onclick={handleReshareClick}
                                            data-customer-name={order.customerName}
                                            data-resource-id={resource.resourceId}
                                            data-resource-name={resource.contentTitle}>
                                            Re-order
                                        </a>
                                    </td>
                                </tr>
                            </template>
                        </tbody>
                    </table>

                    <template for:each={order.orderItems} for:item="resource">
                        <div class="resourceRow_mbl" key={resource.resourceId}>
                            <div class="thumbnail_mbl">
                                <img src={resource.ThumbnailUrl} alt="Thumbnail" class="thumbnail_img" />
                            </div>
                            <div class="resourceContent_mbl">
                                <span class="resourceName_mbl">resource.resourceName</span>
                                <div class="resourceId_mbl">
                                    <span>Resource id</span>
                                    <span class="value_mbl">resource.resourceCode</span>
                                </div>
                                <div class="lastShared_mbl">
                                    <span>Last shared</span>
                                    <span class="value_mbl">{resource.itemQuantity}</span>
                                </div>
                                <div class="resend_mbl">
                                    <a class="resend" onclick={handleReshareClick}
                                        data-customer-name={order.customerName} data-resource-id={resource.resourceId}
                                        data-resource-name={resource.contentTitle}>
                                        Re-share
                                    </a>
                                </div>
                            </div>
                        </div>
                    </template>
                </div>
            </template>
            <div>
                <c-m-s-d_-c-o-r-e_-h-e-q_-pagination total-records={totalRecords} current-page={currentPage}
                    records-per-page-options={recordsPerPageOptions} records-per-page={recordsPerPage}
                    total-pages={totalPages} onpageoptionchange={handlePageOptionChange}
                    onpagechange={handlePageChange}>
                </c-m-s-d_-c-o-r-e_-h-e-q_-pagination>
            </div>
        </div>
    </template>

    <template if:true={isEDeliveryTabActive}>
        <div class="card-container">
            <template for:each={filteredCustomerResourceList} for:item="customer">
                <div class="card" key={customer.customerName}>
                    <div class="left-column">
                        <div class="viewmblcls">
                            <div class="customer-name-mbl">{customer.customerName} </div>
                            <div>
                                <a class="resend" onclick={handleIconClick} data-customer-name={customer.customerName}>
                                    view </a>
                                <!-- <a class="resend close-label" style="display: none;" onclick={handleIconClick} data-customer-name={customer.customerName}>
                                    Close </a> -->
                            </div>
                        </div>
                        <div class="customer-name">{customer.customerName} </div>
                        <div class="customer-email">{customer.email}</div>
                        <hr class="hrmbl">
                    </div>
                    <div class="right-column">
                        <div class="date">Date and time</div>&nbsp;
                        <div class="delivery-date">{customer.lastSharedDateStr}</div>
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="10" viewBox="0 0 16 10" fill="none"
                            class="svgiconcls" onclick={handleIconClick} data-customer-name={customer.customerName}>
                            <path
                                d="M15.8838 1.16002L8.42044 9.81421C8.20681 10.0619 7.79546 10.0619 7.57956 9.81421L0.11623 1.16002C-0.161031 0.837306 0.0889585 0.364598 0.536668 0.364598H15.4633C15.911 0.364598 16.161 0.837306 15.8838 1.16002Z"
                                fill="black" fill-opacity="0.45" />
                        </svg>
                    </div>
                </div>
                <div if:true={customer.isExpanded} key={customer.customerName}>
                    <table class="resourcedetails">
                        <thead class="tableheader">
                            <tr>
                                <th class="headertxt"> </th>
                                <th class="headertext">Resource name</th>
                                <th class="headertext">Resource ID</th>
                                <th class="headertext">Last Shared</th>
                                <th class="headertext"></th>
                            </tr>
                        </thead>
                        <tbody class="tablebody">
                            <template for:each={customer.resources} for:item="resource">
                                <tr key={resource.resourceId}>
                                    <td>
                                        <img src={resource.ThumbnailUrl} alt="Thumbnail" style="width: 30px; height: 36.122px;" />
                                    </td>
                                    <td class="resourceName">{resource.resourceName}</td>
                                    <td>{resource.resourceCode}</td>
                                    <td>{resource.lastShared}</td>
                                    <td class="resend">
                                        <a class="resend" onclick={handleResendClick}
                                            data-customer-name={customer.customerName}
                                            data-customer-email={customer.email} data-resource-id={resource.resourceId}
                                            data-resource-code={resource.resourceCode}
                                            data-record-id={resource.recordId}
                                            data-resource-name={resource.resourceName}>
                                            Re-send
                                        </a>
                                    </td>
                                </tr>
                            </template>
                        </tbody>
                    </table>

                    <template class="slds-backdrop slds-backdrop_open" if:true={showPopup} for:each={customer.resources}
                        for:item="resource">
                        <section role="dialog" tabindex="-1" class="deletepopup" key={customer.customerName}>
                            <div class="header1">
                                <div class="popup-header">Successfully sent</div>
                                <lightning-icon class="closeicon" icon-name="utility:close" alternative-text="close"
                                    title={labels.Close} onclick={closePopup} size="small"></lightning-icon>
                                <span class="slds-assistive-text">{labels.Close}</span>
                            </div>

                            <div class="labelgap">
                                <p class="deletelabelcls">{resource.resourceName} </p>
                                <p class="labelcls">{customer.customerName}</p>
                            </div>
                            <div class="deletepopup-actions">
                                <button class="slds-button slds-button_neutral button"
                    onclick={closePopup}>Ok</button>
                            </div>

                        </section>
                    </template>

                    <template for:each={customer.resources} for:item="resource">
                        <div class="resourceRow_mbl" key={resource.resourceId}>
                            <div class="thumbnail_mbl">
                                <img src={resource.ThumbnailUrl} alt="Thumbnail" class="thumbnail_img" />
                            </div>
                            <div class="resourceContent_mbl">
                                <span class="resourceName_mbl">{resource.resourceName}</span>
                                <div class="resourceId_mbl">
                                    <span>Resource id</span>
                                    <span class="value_mbl">{resource.resourceCode}</span>
                                </div>
                                <div class="lastShared_mbl">
                                    <span>Last shared</span>
                                    <span class="value_mbl">{resource.lastShared}</span>
                                </div>
                                <div class="resend_mbl">
                                    <a class="resend" onclick={handleResendClick}
                                        data-customer-name={customer.customerName} data-customer-email={customer.email}
                                        data-resource-id={resource.resourceId} data-record-id={resource.resourceId}
                                        data-resource-name={resource.resourceName}>
                                        Re-send
                                    </a>
                                </div>
                            </div>
                        </div>
                    </template>
                </div>
            </template>
            <div>
                <c-m-s-d_-c-o-r-e_-h-e-q_-pagination total-records={totalRecords} current-page={currentPage}
                    records-per-page-options={recordsPerPageOptions} records-per-page={recordsPerPage}
                    total-pages={totalPages} onpageoptionchange={handlePageOptionChange}
                    onpagechange={handlePageChange}>
                </c-m-s-d_-c-o-r-e_-h-e-q_-pagination>
            </div>
        </div>

    </template>

</template>