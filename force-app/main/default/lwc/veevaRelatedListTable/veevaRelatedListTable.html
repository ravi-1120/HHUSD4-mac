<template>
    <article class="slds-theme_shade slds-card slds-card_boundary">
        <div class="slds-card__header slds-grid">
            <header class="slds-media slds-media_center slds-has-flexi-truncate">
                <div class="slds-media__figure">
                    <span class="slds-icon_container">
                        <lightning-icon icon-name={iconName} size="small"></lightning-icon>
                    </span>
                </div>
                <div class="slds-media__body">
                    <h2 class="slds-card__header-title">
                        <span class="slds-text-heading_small slds-truncate">{meta.label}</span>
                    </h2>
                    <div>
                        <span if:true={recordTotalCount}>
                            <span class="slds-page-header__meta-text">{recordTotalCountLabel}</span>
                            <span class="slds-page-header__meta-text"
                                if:false={hideCheckboxColumn}>{selectedRowsCountLabel}</span>
                            <span class="slds-page-header__meta-text">{sortedByLabel} </span>
                            <lightning-icon class="header-caret" if:true={sortDirectionIcon} icon-name={sortDirectionIcon}
                                size="xx-small" title="sortIcon"></lightning-icon>
                        </span>
                        <span class="slds-page-header__meta-text">{filtersSelectedLabel}</span>
                    </div>
                </div>
                <div class="slds-grid slds-no-flex">
                    <lightning-button-group if:true={showSearchBox}>
                        <lightning-input class="searchBox" variant="label-hidden" min-length="2"
                            onfocus={handleSearchFocus} onchange={updateSearchTerm}
                            placeholder={msgMap.searchThisListLabel} type="search" value={searchTerm}></lightning-input>
                    </lightning-button-group>
                    <lightning-button-group>
                        <lightning-button-icon icon-name="utility:refresh" variant="border-filled" disabled={isLoading}
                            onclick={handleRefresh}></lightning-button-icon>
                    </lightning-button-group>
                    <lightning-button-group if:true={showFilter}>
                        <span>
                            <lightning-button-icon-stateful icon-name="utility:filterList" variant="border-filled"
                                disabled={disableFilter} onclick={toggleFilterPopover} selected={highlightFilterButton}
                                title={msgMap.filterLabel}></lightning-button-icon-stateful>
                        </span>
                        <c-veeva-list-filter-popover class="filter-popover" if:true={displayFilterPopover}
                            selected={selectedFilters} filter-groups={filters} onapply={applyFilters}
                            onclose={closeFilterPopover}></c-veeva-list-filter-popover>
                    </lightning-button-group>
                    <lightning-file-upload if:true={showFileUpload} class="file-upload" record-id={parentId}
                        onuploadfinished={handleUploadFinished} multiple></lightning-file-upload>
                    <lightning-button-group>
                        <template for:each={buttons} for:item="button">
                            <lightning-button key={button.name} label={button.label} name={button.name}
                                onclick={handleButton}></lightning-button>
                        </template>
                    </lightning-button-group>
                </div>
            </header>
        </div>
        <div if:true={columns}>
            <c-veeva-edit-datatable-container if:false={ctrl.isTree} draft-values={draftValues} columns={columns} records={records}
                object-api-name={objectApiName} ondraftchange={handleDraftValuesChange}>
                <div class={relatedListStyle} slot="dataTable">
                    <c-veeva-datatable onrowselection={handleRowSelection} onrowaction={handleRowAction}
                        oncellchange={handleCellChange} draft-values={draftValues} oncancel={handleDatatableCancel}
                        key-field="Id" onsave={handleSave} errors={errors} data={records} columns={columns}
                        onloadmore={loadMoreData} load-more-offset="5" show-row-number-column
                        hide-checkbox-column={hideCheckboxColumn} enable-infinite-loading={hasMoreData}
                        is-loading={isLoading} sorted-direction={sortDirection} sorted-by={sortBy} onsort={handleSort}
                        max-row-selection={maxRowSelection} data-table-edit min-column-width="175"
                        onlinkclick={handleLinkClick}>
                    </c-veeva-datatable>
                </div>
            </c-veeva-edit-datatable-container>
            <div class={relatedListStyle} if:true={ctrl.isTree}>
                <lightning-tree-grid onrowaction={handleRowAction}
                    key-field="Id" data={records} columns={columns}
                    show-row-number-column
                    hide-checkbox-column={hideCheckboxColumn} min-column-width="175"
                    onlinkclick={handleLinkClick}>
                </lightning-tree-grid>
            </div>
            <c-veeva-spinner if:true={isLoading} class="slds-spinner_container"></c-veeva-spinner>
            <div if:true={noRecords} class={noRecordsClass}>{msgMap.noRecordsMsg}</div>
        </div>
    </article>
    <c-veeva-confirmation-modal show={showDeleteModal} title={deleteModalHeader} messages={deleteModalBody}
        confirm-label={msgDelete} cancel-label={msgCancel} disable-buttons={isDeleting} onconfirm={handleDelete}
        oncancel={handleCancel}>
    </c-veeva-confirmation-modal>
</template>