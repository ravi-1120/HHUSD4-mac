<template>
    <div class="container">
        <div if:true={isSidebar}>
            <div class="headerdivcls">
                <div class="slds-grid slds-grid_align-spread headertxt">
                    <div class="filtertxtcls">
                        {label.Filter}
                    </div>
                    <div class="doublelefticoncls" onclick={closesidebar}>
                        <img src={lefticon}>
                    </div>
                </div>
                <template if:false={showSaveSearch}>
                    <div>
                        <input class="slds-input inputcls" placeholder={label.keywordsearch} type="text">
                    </div>
                    <div>
                        <button class="slds-button buttoncls1 slds-button_neutral" label={label.SaveSearch}
                                        onclick={openSaveSearchModal}>{label.SaveSearch}</button>
                    </div>
                    <div>
                        <button class="slds-button buttoncls2 slds-button_neutral" label={label.ViewSaved}
                                        onclick={openViewSavedModal}>{label.ViewSaved}</button>
                    </div>
                </template>
            </div>
            <div class="categorycontainer">
                <div if:true={searchCategory}>
                    <template for:each={searchCategory} for:item="category">
                        <div key={category.id}>
                            <div class={category.selectedcategorycls} data-id={category.id} onclick={toggleSection}>
                                <div class="categorycls">
                                    <span class="categoryname">{category.name}</span>
                                </div>
                                <div class="iconToggle">
                                    <lightning-icon icon-name={category.iconName} alternative-text="Toggle"
                                        size="x-small"></lightning-icon>
                                </div>
                            </div>
                            <template if:true={category.isOpen}>
                                <div class="childcategorypadding">
                                    <template for:each={category.childCategories} for:item="childCategory">
                                        <div key={childCategory.id}>
                                            <div class="folder-subitem">
                                                <div class="categorycls">
                                                    <template if:false={childCategory.isPartial}>
                                                        <div class="checkcls" if:false={childCategory.isChecked} data-checked="true" data-id={childCategory.id} onclick={handleCheck}>
                                                            <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                                <path d="M11.52 0H0.48C0.2145 0 0 0.2145 0 0.48V11.52C0 11.7855 0.2145 12 0.48 12H11.52C11.7855 12 12 11.7855 12 11.52V0.48C12 0.2145 11.7855 0 11.52 0ZM10.92 10.92H1.08V1.08H10.92V10.92Z" fill="black" fill-opacity="0.45"/>
                                                            </svg>                                                                                                                                   
                                                        </div>
                                                        <div class="checkcls" if:true={childCategory.isChecked}  data-checked="false" data-id={childCategory.id} onclick={handleCheck}>
                                                            <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                                <path d="M11.519 0H0.479023C0.213523 0 -0.000976562 0.2145 -0.000976562 0.48V11.52C-0.000976562 11.7855 0.213523 12 0.479023 12H11.519C11.7845 12 11.999 11.7855 11.999 11.52V0.48C11.999 0.2145 11.7845 0 11.519 0ZM8.75152 3.8055L5.59252 8.1855C5.54837 8.24712 5.49017 8.29734 5.42273 8.33198C5.3553 8.36662 5.28058 8.38469 5.20477 8.38469C5.12896 8.38469 5.05425 8.36662 4.98681 8.33198C4.91938 8.29734 4.86118 8.24712 4.81702 8.1855L2.94652 5.5935C2.88952 5.514 2.94652 5.403 3.04402 5.403H3.74752C3.90052 5.403 4.04602 5.4765 4.13602 5.6025L5.20402 7.0845L7.56202 3.8145C7.65202 3.69 7.79602 3.615 7.95052 3.615H8.65402C8.75152 3.615 8.80852 3.726 8.75152 3.8055Z" fill="black" fill-opacity="0.45"/>
                                                            </svg>                                                                
                                                        </div>
                                                    </template>
                                                    <div class="checkcls" if:true={childCategory.isPartial}>
                                                        <svg width="13" height="12" viewBox="0 0 13 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                            <g clip-path="url(#clip0_3183_61620)">
                                                                <path
                                                                    d="M10.9886 12C11.7039 12 12.2839 11.4244 12.2839 10.7143V1.28571C12.2839 0.575631 11.7039 0 10.9886 0H1.48964C0.774262 0 0.194336 0.575631 0.194336 1.28571V10.7143C0.194336 11.4244 0.774262 12 1.48964 12H10.9886Z"
                                                                    fill="#8C8C8C" />
                                                            </g>
                                                            <rect x="2.20898" y="5" width="8.0597" height="2" rx="1" fill="white" />
                                                            <defs>
                                                                <clipPath id="clip0_3183_61620">
                                                                    <rect width="12.0895" height="12" fill="white" transform="translate(0.194336)" />
                                                                </clipPath>
                                                            </defs>
                                                        </svg>
                                                    </div>
                                                    <span class="categoryname">{childCategory.name}</span>
                                                    <span class="countcls" if:true={childCategory.childCategories}>{childCategory.totalContentDocumentCount}</span>
                                                    <span class="countcls" if:false={childCategory.childCategories}>{childCategory.contentDocumentCount}</span>
                                                </div>
                                                <div class="iconToggle" data-id={childCategory.id}
                                                    onclick={toggleSection} if:true={childCategory.isIconVisible}>
                                                    <lightning-icon icon-name={childCategory.iconName}
                                                        alternative-text="Toggle" size="x-small"></lightning-icon>
                                                </div>
                                            </div>
                                            <template if:true={childCategory.isOpen}>
                                                <div class="subchildcategorypadding">
                                                    <template for:each={childCategory.childCategories}
                                                        for:item="grandChildCategory">
                                                        <div key={grandChildCategory.id} class="folder-subitem">
                                                            <div class="categorycls">
                                                                <div class="checkcls" if:false={grandChildCategory.isChecked} data-checked="true" data-id={grandChildCategory.id} onclick={handleCheck}>
                                                                    <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                                        <path d="M11.52 0H0.48C0.2145 0 0 0.2145 0 0.48V11.52C0 11.7855 0.2145 12 0.48 12H11.52C11.7855 12 12 11.7855 12 11.52V0.48C12 0.2145 11.7855 0 11.52 0ZM10.92 10.92H1.08V1.08H10.92V10.92Z" fill="black" fill-opacity="0.45"/>
                                                                    </svg>                                                                                                                                   
                                                                </div>
                                                                <div class="checkcls" if:true={grandChildCategory.isChecked}  data-checked="false" data-id={grandChildCategory.id} onclick={handleCheck}>
                                                                    <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                                        <path d="M11.519 0H0.479023C0.213523 0 -0.000976562 0.2145 -0.000976562 0.48V11.52C-0.000976562 11.7855 0.213523 12 0.479023 12H11.519C11.7845 12 11.999 11.7855 11.999 11.52V0.48C11.999 0.2145 11.7845 0 11.519 0ZM8.75152 3.8055L5.59252 8.1855C5.54837 8.24712 5.49017 8.29734 5.42273 8.33198C5.3553 8.36662 5.28058 8.38469 5.20477 8.38469C5.12896 8.38469 5.05425 8.36662 4.98681 8.33198C4.91938 8.29734 4.86118 8.24712 4.81702 8.1855L2.94652 5.5935C2.88952 5.514 2.94652 5.403 3.04402 5.403H3.74752C3.90052 5.403 4.04602 5.4765 4.13602 5.6025L5.20402 7.0845L7.56202 3.8145C7.65202 3.69 7.79602 3.615 7.95052 3.615H8.65402C8.75152 3.615 8.80852 3.726 8.75152 3.8055Z" fill="black" fill-opacity="0.45"/>
                                                                    </svg>                                                                
                                                                </div>
                                                                <span class="categoryname">{grandChildCategory.name}</span>
                                                                <span class="countcls">{grandChildCategory.contentDocumentCount}</span>
                                                            </div>
                                                            <button class="slds-button slds-button_icon"
                                                                data-id={grandChildCategory.id} onclick={toggleSection}>
                                                            </button>
                                                        </div>
                                                    </template>
                                                </div>
                                            </template>
                                        </div>
                                    </template>
                                </div>
                            </template>
                        </div>
                    </template>
                </div>
            </div>
            <div class="bottombuttoncls">
                <button class="slds-button slds-button_neutral" type="button" onclick={handleClearClick}>
                    {label.clearall}</button>
                <button class="slds-button slds-button_brand" type="button"
                    onclick={handleSubmit}>{label.submit}</button>
            </div>
        </div>
        <div class="righticoncls" if:false={isSidebar}>
            <div class="doublerighticoncls" onclick={opensidebar}>
                <img src={righticon}>
            </div>
        </div>
    </div>

    <!-- Modal for saving search -->
    <template class="slds-backdrop slds-backdrop_open" if:true={isSaveModalOpen}>
        <section role="dialog" tabindex="-1" class="popup">
            <div class="header">
                <div class="popup-header">{label.SaveSearch}</div>
                <lightning-icon class="closeicon" icon-name="utility:close" alternative-text="close" title={label.Close}
                    onclick={closeSaveModal} size="small"></lightning-icon>
                <span class="slds-assistive-text">{label.Close}</span>
            </div>

            <div class="labelgap">
                <p class="labelcls">{label.EnterNewName} </p>
                <input class="inputbox" label={label.NewName} placeholder="New name" placevalue={searchName}
                    oninput={handleNameChange}>
            </div>
            <template if:true={errorMessage}>
                <div class="slds-text-color_error">
                    {errorMessage}
                </div>
            </template>
            <div class="popup-actions">
                <button class="slds-button slds-button_brand button" disabled={isSaveButtonDisabled}
                    onclick={handleSaveSearch}>{label.Save}</button>
                <button class="slds-button slds-button_neutral button" onclick={closeSaveModal}>{label.cancel}</button>
            </div>
        </section>
        <div class="slds-backdrop slds-backdrop_"></div>
    </template>



    <!-- Modal for viewing saved searches -->
    <template if:true={isViewSavedModalOpen}>
        <section role="dialog" tabindex="-1" class="viewpopup slds-backdrop slds-backdrop_open">
            <div class="header">
                <div class="popup-header">{label.SavedSearch}</div>
                <lightning-icon class="closeicon" icon-name="utility:close" alternative-text="close" title={label.Close}
                    onclick={closeViewSavedModal} size="small"></lightning-icon>
                <span class="slds-assistive-text">{label.Close}</span>
            </div>

            <div class="slds-p-around_medium viewlayout">
                <template if:true={savedSearches.length}>
                    <template for:each={savedSearches} for:item="savedSearch">
                        <div key={savedSearch.Id} class="saved-search-item">
                            <a href="javascript:void(0);" class="saved-search-name" data-id={savedSearch.Id}
                                onclick={handleViewSavedSearch}>
                                {savedSearch.MSD_CORE_Search_Name__c}
                            </a>
                            <div class="icon-buttons">
                                <button data-id={savedSearch.Id} class="icon-button" onclick={handleRenameSavedSearch}
                                    aria-label="Edit">
                                    <img src={editIcon} alt="Edit Icon">
                                </button>
                                <button data-id={savedSearch.Id} class="icon-button" onclick={handleDeleteSavedSearch}
                                    aria-label="Delete">
                                    <img src={deleteIcon} alt="Delete Icon">
                                </button>
                            </div>
                        </div>
                    </template>
                </template>
                <template if:false={savedSearches.length}>
                    <p>{label.noresultfound}</p>
                </template>
            </div>
            <div class="popup-actions">
                <button class="slds-button slds-button_neutral cancelbutton"
                    onclick={closeViewSavedModal}>{label.cancel}</button>
            </div>
        </section>
        <div class="slds-backdrop slds-backdrop_open"></div>
    </template>

    <!-- Rename Saved Search Modal -->
    <template class="slds-backdrop slds-backdrop_open" if:true={isRenameModalOpen}>
        <section role="dialog" tabindex="-1" class="popup">
            <div class="header">
                <div class="popup-header">{label.Rename}</div>
                <lightning-icon class="closeicon" icon-name="utility:close" alternative-text="close" title={label.Close}
                    onclick={closeRenameModal} size="small"></lightning-icon>
                <span class="slds-assistive-text">{label.Close}</span>
            </div>

            <div class="labelgap">
                <p class="labelcls">{label.editName}</p>
                <input class="inputbox" label={label.EditName} value={newSearchName} oninput={handleNewNameChange}>
            </div>
            <template if:true={errorMessage}>
                <div class="slds-text-color_error">
                    {errorMessage}
                </div>
            </template>
            <div class="popup-actions">
                <button class="slds-button slds-button_brand button"
                onclick={saveNewName} disabled={isSaveButtonDisabled}>{label.Save}</button>
                <button class="slds-button slds-button_neutral button"
                onclick={closeRenameModal}>{label.cancel}</button>
            </div>
        </section>
        <div class="slds-backdrop slds-backdrop_open"></div>
    </template>

    <!-- Delete Confirmation Modal -->
    <template class="slds-backdrop slds-backdrop_open" if:true={isDeleteModalOpen}>
        <section role="dialog" tabindex="-1" class="deletepopup">
            <div class="header">
                <div class="popup-header">{label.ConfirmDelete}</div>
                <lightning-icon class="closeicon" icon-name="utility:close" alternative-text="close" title={label.Close}
                    onclick={closeDeleteModal} size="small"></lightning-icon>
                <span class="slds-assistive-text">{label.Close}</span>
            </div>

            <div class="labelgap">
                <p class="deletelabelcls">{label.warningmsg1} </p>
            </div>
            <div class="deletepopup-actions">
                <button class="slds-button slds-button_brand button" onclick={confirmDelete}>Delete</button>
                <button class="slds-button slds-button_neutral button"
                    onclick={closeDeleteModal}>{label.cancel}</button>
            </div>
        </section>
        <div class="slds-backdrop slds-backdrop_open"></div>
    </template>

    <!-- Spinner -->
    <div if:true={showSpinner}>
        <c-m-s-d_-c-o-r-e_-h-e-q_-spinner></c-m-s-d_-c-o-r-e_-h-e-q_-spinner>
    </div>
    <template if:true={filter}>
        <c-m-s-d_-c-o-r-e_-h-e-q_-all-resource selected-categories-array={selectedCategoriesArray}>
        </c-m-s-d_-c-o-r-e_-h-e-q_-all-resource>
    </template>
</template>